const keys = document.querySelectorAll('.key');
const output = document.getElementById('output');
const freeMoveCheckbox = document.getElementById('free-move-checkbox');

const stenoOrder = "STKPWHRAO*EUFRPBLGTSDZ"; // Define stenography order

function handleTouch(e) {
    e.preventDefault();
    const pressedKeys = [];
    for (let touch of e.touches) {
        const key = document.elementFromPoint(touch.clientX, touch.clientY);
        if (key && key.classList.contains('key')) {
            pressedKeys.push(key.dataset.key);
        }
    }

    // Sort pressedKeys according to stenography order
    pressedKeys.sort((a, b) => {
        return stenoOrder.indexOf(a) - stenoOrder.indexOf(b);
    });

    // Concatenate pressed keys into a single string
    let pressedKeysString = '';
    pressedKeys.forEach(key => {
        pressedKeysString += key;
    });

    output.textContent = `Pressed Key: ${pressedKeysString}`;
}

document.querySelector('.keyboard').addEventListener('touchstart', handleTouch, { passive: false });
document.querySelector('.keyboard').addEventListener('touchmove', handleTouch, { passive: false });
document.querySelector('.keyboard').addEventListener('touchend', handleTouch, { passive: false });
document.querySelector('.keyboard').addEventListener('touchcancel', handleTouch, { passive: false });

// Checkbox functionality remains unchanged
freeMoveCheckbox.addEventListener('change', function () {
    const keys = document.querySelectorAll('.key');
    keys.forEach(key => {
        if (this.checked) {
            key.classList.add('draggable');
            key.setAttribute('draggable', 'true');
        } else {
            key.classList.remove('draggable');
            key.removeAttribute('draggable');
        }
    });

    if (this.checked) {
        keys.forEach(key => {
            key.addEventListener('dragstart', function (e) {
                e.dataTransfer.setData('text/plain', key.dataset.key);
            });
        });

        document.addEventListener('dragover', function (e) {
            e.preventDefault();
        });

        document.addEventListener('drop', function (e) {
            const data = e.dataTransfer.getData('text/plain');
            const key = document.elementFromPoint(e.clientX, e.clientY);
            if (key && key.classList.contains('key')) {
                key.textContent = data;
                output.textContent = `Dropped Key: ${data}`;
            }
        });
    } else {
        keys.forEach(key => {
            key.removeEventListener('dragstart', function () { });
        });

        document.removeEventListener('dragover', function () { });
        document.removeEventListener('drop', function () { });
    }
});
